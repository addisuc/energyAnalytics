<div class="energy-analytics-container">
  <!-- Header Section -->
  <div class="analytics-header">
    <div class="header-content">
      <h1 class="page-title">Energy Generation Dashboard</h1>
      <p class="page-subtitle">Real-time energy generation and consumption analytics</p>
    </div>
    
    <div class="header-controls">
      <!-- Region Selector -->
      <div class="region-selector">
        <label for="region-select" class="selector-label">Region:</label>
        <select 
          id="region-select"
          [(ngModel)]="selectedRegion" 
          (change)="onRegionChange()"
          class="region-select"
          [disabled]="isLoading">
          <option *ngFor="let region of availableRegions" [value]="region.value">
            {{ region.label }} ({{ region.code }})
          </option>
        </select>
      </div>
      
      <!-- Refresh Button -->
      <button 
        class="refresh-button"
        (click)="refreshData()"
        [disabled]="isLoading"
        [attr.aria-label]="'Refresh data for ' + selectedRegion">
        <i class="material-icons" [class.spinning]="isLoading">refresh</i>
        <span class="button-text">Refresh</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !energyData" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading energy data for {{ selectedRegion }}...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !energyData" class="error-container">
    <div class="error-icon">
      <i class="material-icons">error_outline</i>
    </div>
    <h3 class="error-title">Unable to Load Data</h3>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="refreshData()">
      <i class="material-icons">refresh</i>
      Try Again
    </button>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="energyData" class="dashboard-content">
    
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item">
        <span class="status-label">Last Updated:</span>
        <span class="status-value">{{ getTimeSinceUpdate() }}</span>
      </div>
      <div class="status-item">
        <span class="status-label">Status:</span>
        <span class="status-value" [class]="getGenerationStatus().color">
          {{ getGenerationStatus().status }}
        </span>
      </div>
      <div class="status-item">
        <span class="status-label">Region:</span>
        <span class="status-value">{{ selectedRegion | titlecase }}</span>
      </div>
    </div>

    <!-- Key Metrics Cards -->
    <div class="metrics-grid">
      
      <!-- Total Generation Card -->
      <div class="metric-card generation-card">
        <div class="card-header">
          <h3 class="card-title">Total Generation</h3>
          <i class="card-icon material-icons">bolt</i>
        </div>
        <div class="card-content">
          <div class="metric-value">
            {{ formatMegawatts(energyData.currentGeneration.total) }}
          </div>
          <div class="metric-breakdown">
            <div class="breakdown-item">
              <span class="breakdown-label">Solar:</span>
              <span class="breakdown-value">{{ formatMegawatts(energyData.currentGeneration.solar) }}</span>
              <div class="breakdown-bar">
                <div class="bar-fill solar" [style.width.%]="getGenerationPercentage('solar')"></div>
              </div>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Wind:</span>
              <span class="breakdown-value">{{ formatMegawatts(energyData.currentGeneration.wind) }}</span>
              <div class="breakdown-bar">
                <div class="bar-fill wind" [style.width.%]="getGenerationPercentage('wind')"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Consumption Card -->
      <div class="metric-card consumption-card">
        <div class="card-header">
          <h3 class="card-title">Current Demand</h3>
          <i class="card-icon material-icons">trending_up</i>
        </div>
        <div class="card-content">
          <div class="metric-value">
            {{ formatMegawatts(energyData.consumption) }}
          </div>
          <div class="demand-indicator">
            <div class="indicator-bar">
              <div 
                class="demand-fill" 
                [style.width.%]="Math.min((energyData.consumption / energyData.currentGeneration.total) * 100, 100)">
              </div>
            </div>
            <span class="indicator-label">
              {{ ((energyData.consumption / energyData.currentGeneration.total) * 100).toFixed(1) }}% of generation
            </span>
          </div>
        </div>
      </div>

      <!-- Efficiency Card -->
      <div class="metric-card efficiency-card">
        <div class="card-header">
          <h3 class="card-title">Efficiency</h3>
          <i class="card-icon material-icons">speed</i>
        </div>
        <div class="card-content">
          <div class="metric-value" [class]="getEfficiencyColor(energyData.efficiency)">
            {{ energyData.efficiency.toFixed(1) }}%
          </div>
          <div class="efficiency-gauge">
            <div class="gauge-track">
              <div 
                class="gauge-fill" 
                [style.width.%]="Math.min(energyData.efficiency, 100)"
                [class]="getEfficiencyColor(energyData.efficiency)">
              </div>
            </div>
            <div class="gauge-labels">
              <span>0%</span>
              <span>50%</span>
              <span>100%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Risk Assessment Card -->
      <div class="metric-card risk-card">
        <div class="card-header">
          <h3 class="card-title">Risk Assessment</h3>
          <i class="card-icon material-icons">warning</i>
        </div>
        <div class="card-content">
          <div class="risk-score">
            <span class="risk-value" [class]="getRiskLevel(energyData.riskScore).color">
              {{ energyData.riskScore.toFixed(0) }}
            </span>
            <span class="risk-level" [class]="getRiskLevel(energyData.riskScore).color">
              {{ getRiskLevel(energyData.riskScore).level }} Risk
            </span>
          </div>
          <div class="risk-indicator">
            <div class="risk-bar">
              <div 
                class="risk-fill" 
                [style.width.%]="energyData.riskScore"
                [class]="getRiskLevel(energyData.riskScore).color">
              </div>
            </div>
            <div class="risk-thresholds">
              <span class="threshold low">Low</span>
              <span class="threshold medium">Medium</span>
              <span class="threshold high">High</span>
              <span class="threshold critical">Critical</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Supply vs Demand Chart Placeholder -->
    <div class="chart-section">
      <div class="chart-header">
        <h3 class="chart-title">Supply vs Demand Overview</h3>
        <p class="chart-subtitle">Real-time comparison of energy generation and consumption</p>
      </div>
      <div class="chart-placeholder">
        <div class="chart-bars">
          <div class="bar-group">
            <div class="bar supply" [style.height.%]="(energyData.currentGeneration.total / Math.max(energyData.currentGeneration.total, energyData.consumption)) * 100">
              <span class="bar-label">Supply</span>
              <span class="bar-value">{{ formatMegawatts(energyData.currentGeneration.total) }}</span>
            </div>
          </div>
          <div class="bar-group">
            <div class="bar demand" [style.height.%]="(energyData.consumption / Math.max(energyData.currentGeneration.total, energyData.consumption)) * 100">
              <span class="bar-label">Demand</span>
              <span class="bar-value">{{ formatMegawatts(energyData.consumption) }}</span>
            </div>
          </div>
        </div>
        <div class="chart-note">
          <i class="material-icons">info</i>
          <span>Advanced charting features available in Pro and Enterprise plans</span>
        </div>
      </div>
    </div>
  </div>
</div>