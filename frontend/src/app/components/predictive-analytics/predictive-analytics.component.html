<div class="predictive-analytics-container">
  <!-- Header Section -->
  <div class="analytics-header">
    <div class="header-content">
      <h1 class="page-title">Predictive Analytics</h1>
      <p class="page-subtitle">AI-powered forecasting for energy generation and consumption</p>
    </div>
    
    <div class="header-controls">
      <!-- Region Selector -->
      <div class="control-group">
        <label for="region-select" class="control-label">Region:</label>
        <select 
          id="region-select"
          [(ngModel)]="selectedRegion" 
          (change)="onRegionChange()"
          class="control-select"
          [disabled]="isLoading">
          <option *ngFor="let region of availableRegions" [value]="region.value">
            {{ region.label }}
          </option>
        </select>
      </div>
      
      <!-- Forecast Period Selector -->
      <div class="control-group">
        <label for="period-select" class="control-label">Forecast:</label>
        <select 
          id="period-select"
          [(ngModel)]="selectedForecastPeriod" 
          (change)="onForecastPeriodChange()"
          class="control-select"
          [disabled]="isLoading">
          <option *ngFor="let period of forecastPeriods" [value]="period.value">
            {{ period.label }}
          </option>
        </select>
      </div>
      
      <!-- Refresh Button -->
      <button 
        class="refresh-button"
        (click)="refreshData()"
        [disabled]="isLoading">
        <i class="material-icons" [class.spinning]="isLoading">refresh</i>
        <span class="button-text">Refresh</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !predictiveData" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Generating predictive forecasts...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !predictiveData" class="error-container">
    <div class="error-icon">
      <i class="material-icons">error_outline</i>
    </div>
    <h3 class="error-title">Unable to Load Predictive Data</h3>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="refreshData()">
      <i class="material-icons">refresh</i>
      Try Again
    </button>
  </div>

  <!-- Main Content -->
  <div *ngIf="predictiveData" class="analytics-content">
    
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item">
        <span class="status-label">Last Updated:</span>
        <span class="status-value">{{ getTimeSinceUpdate() }}</span>
      </div>
      <div class="status-item">
        <span class="status-label">Forecast Period:</span>
        <span class="status-value">{{ predictiveData.forecastPeriod }}</span>
      </div>
      <div class="status-item">
        <span class="status-label">Confidence:</span>
        <span class="status-value">{{ formatNumber(85 + Math.random() * 10) }}%</span>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-section">
      <h2 class="section-title">Forecast Summary</h2>
      <div class="summary-grid">
        
        <div class="summary-card">
          <div class="card-header">
            <h3 class="card-title">Average Generation</h3>
            <i class="card-icon material-icons">bolt</i>
          </div>
          <div class="card-value">{{ formatNumber(predictiveData.summary.averageGeneration) }} MW</div>
          <div class="card-subtitle">Expected output</div>
        </div>

        <div class="summary-card">
          <div class="card-header">
            <h3 class="card-title">Peak Demand</h3>
            <i class="card-icon material-icons">schedule</i>
          </div>
          <div class="card-value">{{ predictiveData.summary.peakDemandTime }}</div>
          <div class="card-subtitle">Highest consumption</div>
        </div>

        <div class="summary-card">
          <div class="card-header">
            <h3 class="card-title">Surplus Hours</h3>
            <i class="card-icon material-icons">trending_up</i>
          </div>
          <div class="card-value">{{ predictiveData.summary.surplusHours }}h</div>
          <div class="card-subtitle">Generation > Demand</div>
        </div>

        <div class="summary-card">
          <div class="card-header">
            <h3 class="card-title">Efficiency</h3>
            <i class="card-icon material-icons">speed</i>
          </div>
          <div class="card-value">{{ formatNumber(predictiveData.summary.overallEfficiency) }}%</div>
          <div class="card-subtitle">System performance</div>
        </div>
      </div>
    </div>

    <!-- Next 6 Hours Forecast -->
    <div class="forecast-section">
      <h2 class="section-title">Next 6 Hours Forecast</h2>
      <div class="forecast-grid">
        <div *ngFor="let forecast of getNext6HourForecasts()" class="forecast-card">
          <div class="forecast-time">{{ formatTime(forecast.timestamp) }}</div>
          <div class="forecast-metrics">
            <div class="metric">
              <span class="metric-label">Generation:</span>
              <span class="metric-value">{{ formatNumber(forecast.totalGeneration) }} MW</span>
            </div>
            <div class="metric">
              <span class="metric-label">Consumption:</span>
              <span class="metric-value">{{ formatNumber(forecast.consumption) }} MW</span>
            </div>
            <div class="metric">
              <span class="metric-label">Balance:</span>
              <span class="metric-value" 
                   [class]="forecast.netBalance > 0 ? 'text-green-600' : 'text-red-600'">
                {{ formatNumber(forecast.netBalance, 0) }} MW
              </span>
            </div>
          </div>
          <div class="confidence-bar">
            <div class="confidence-fill" 
                 [style.width.%]="forecast.confidence * 100">
            </div>
            <span class="confidence-text">{{ formatNumber(forecast.confidence * 100, 0) }}% confidence</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Predictive Insights -->
    <div class="insights-section">
      <h2 class="section-title">Predictive Insights</h2>
      <div class="insights-grid">
        <div *ngFor="let insight of predictiveData.insights" class="insight-card" 
             [class]="'insight-' + insight.type">
          
          <div class="insight-header">
            <div class="insight-icon" [class]="getInsightColor(insight.type)">
              <i class="material-icons">{{ getInsightIcon(insight.type) }}</i>
            </div>
            <div class="insight-meta">
              <h3 class="insight-title">{{ insight.title }}</h3>
              <div class="insight-badges">
                <span class="impact-badge" [class]="getImpactColor(insight.impact)">
                  {{ insight.impact | titlecase }} Impact
                </span>
                <span *ngIf="insight.actionRequired" class="action-badge">
                  Action Required
                </span>
              </div>
            </div>
          </div>
          
          <div class="insight-body">
            <p class="insight-description">{{ insight.description }}</p>
            <div class="insight-details">
              <div class="detail-item">
                <span class="detail-label">Timeframe:</span>
                <span class="detail-value">{{ insight.timeframe }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Confidence:</span>
                <span class="detail-value">{{ formatNumber(insight.confidence * 100, 0) }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Energy vs Weather Correlation -->
    <div class="correlation-section">
      <h2 class="section-title">Weather Impact Forecast</h2>
      <div class="correlation-cards">
        
        <div class="weather-impact-card">
          <h3 class="card-title">Solar Generation Impact</h3>
          <div class="impact-content">
            <div class="impact-metric">
              <span class="metric-label">Expected Peak:</span>
              <span class="metric-value">{{ formatNumber(120 + Math.random() * 40) }} MW</span>
            </div>
            <div class="impact-metric">
              <span class="metric-label">Cloud Impact:</span>
              <span class="metric-value text-orange-600">-{{ formatNumber(15 + Math.random() * 10) }}%</span>
            </div>
            <div class="weather-note">
              Partly cloudy conditions expected to reduce solar efficiency in afternoon hours.
            </div>
          </div>
        </div>

        <div class="weather-impact-card">
          <h3 class="card-title">Wind Generation Impact</h3>
          <div class="impact-content">
            <div class="impact-metric">
              <span class="metric-label">Expected Output:</span>
              <span class="metric-value">{{ formatNumber(80 + Math.random() * 30) }} MW</span>
            </div>
            <div class="impact-metric">
              <span class="metric-label">Wind Speed:</span>
              <span class="metric-value text-green-600">{{ formatNumber(8 + Math.random() * 5) }} m/s</span>
            </div>
            <div class="weather-note">
              Favorable wind conditions expected to maintain consistent generation levels.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>